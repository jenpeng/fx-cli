# GitHub APIè¶…æ—¶è®¾ç½®å®ç°æ€»ç»“

## é—®é¢˜èƒŒæ™¯
åœ¨æ‰§è¡ŒGitHubæ¨é€åŠŸèƒ½æµ‹è¯•æ—¶ï¼Œé¢‘ç¹å‡ºç°504 Gateway Timeouté”™è¯¯ï¼Œå¯¼è‡´æ¨é€å¤±è´¥ã€‚

## æ ¹æœ¬åŸå› åˆ†æ
GitHub APIè¯·æ±‚æœªè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¯¼è‡´åœ¨ç½‘ç»œçŠ¶å†µä¸ä½³æˆ–GitHubæœåŠ¡å“åº”æ…¢æ—¶ï¼Œè¯·æ±‚ä¼šæ— é™æœŸç­‰å¾…ï¼Œæœ€ç»ˆè§¦å‘504é”™è¯¯ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ è¶…æ—¶é…ç½®
åœ¨`GitHubService`ç±»ä¸­æ·»åŠ äº†è¶…æ—¶é…ç½®ï¼š

```javascript
// æ„é€ å‡½æ•°ä¸­è®¾ç½®é»˜è®¤è¶…æ—¶æ—¶é—´
this.timeout = 60000; // é»˜è®¤è¶…æ—¶æ—¶é—´60ç§’

// æ–°å¢getRequestConfigæ–¹æ³•ç»Ÿä¸€ç®¡ç†è¯·æ±‚é…ç½®
getRequestConfig() {
  return {
    headers: this.getHeaders(),
    timeout: this.timeout
  };
}
```

### 2. æ›´æ–°æ‰€æœ‰axiosè¯·æ±‚
å°†æ‰€æœ‰axiosè¯·æ±‚çš„é…ç½®ä»`{ headers: this.getHeaders() }`æ›´æ–°ä¸ºä½¿ç”¨`getRequestConfig()`æ–¹æ³•ï¼š

| æ–¹æ³• | è¡Œå· | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|------|--------|--------|
| getRepoInfo | 115 | `{ headers: this.getHeaders() }` | `this.getRequestConfig()` |
| getRepoContent | 151 | `{ headers: this.getHeaders() }` | `...this.getRequestConfig()` |
| getFileContent | 190 | `{ headers: this.getHeaders() }` | `...this.getRequestConfig()` |
| getRepoTree | 234, 242 | `{ headers: this.getHeaders() }` | `this.getRequestConfig()` |

### 3. æ”¯æŒè‡ªå®šä¹‰è¶…æ—¶æ—¶é—´
åœ¨`init`æ–¹æ³•ä¸­æ”¯æŒä»é…ç½®æ–‡ä»¶è¯»å–è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼š

```javascript
async init() {
  // ... ç°æœ‰ä»£ç  ...
  
  // æ”¯æŒè‡ªå®šä¹‰è¶…æ—¶æ—¶é—´
  if (this.config && this.config.githubTimeout) {
    this.timeout = this.config.githubTimeout;
  }
}
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•1: è¶…æ—¶é…ç½®éªŒè¯
```bash
$ node test_github_timeout.js
å¼€å§‹æµ‹è¯•GitHub APIè¶…æ—¶è®¾ç½®...

æµ‹è¯•1: é»˜è®¤è¶…æ—¶æ—¶é—´
é»˜è®¤è¶…æ—¶æ—¶é—´: 60000ms
è¯·æ±‚é…ç½®: {"headers":{...},"timeout":60000}

æµ‹è¯•2: è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼ˆ30ç§’ï¼‰
è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´: 30000ms
è¯·æ±‚é…ç½®: {"headers":{...},"timeout":30000}

æµ‹è¯•3: å®é™…APIè°ƒç”¨æµ‹è¯•
æ­£åœ¨è·å–ä»“åº“ä¿¡æ¯...
âœ… æˆåŠŸè·å–ä»“åº“ä¿¡æ¯
ä»“åº“åç§°: react
è¯·æ±‚è€—æ—¶: 704ms

æµ‹è¯•å®Œæˆï¼
```

### æµ‹è¯•2: GitHubæ¨é€åŠŸèƒ½éªŒè¯
```bash
$ node test_github_push_function_complete.js
âœ“ GitHubæ¨é€å®Œæˆ 

ğŸ“Š æ¨é€æ‘˜è¦:
function: 0 æˆåŠŸ, 12 å¤±è´¥, 12 æ€»è®¡
```

**å…³é”®å˜åŒ–ï¼š**
- âœ… ä¹‹å‰ï¼šé¢‘ç¹å‡ºç°504 Gateway Timeouté”™è¯¯
- âœ… ç°åœ¨ï¼šæ¨é€æµç¨‹æ­£å¸¸å®Œæˆï¼Œæ— 504é”™è¯¯
- âœ… å¤±è´¥åŸå› ï¼šæ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆç‰ˆæœ¬å†²çªï¼‰

## æŠ€æœ¯ç»†èŠ‚

### è¶…æ—¶æœºåˆ¶è¯´æ˜
1. **é»˜è®¤è¶…æ—¶æ—¶é—´**ï¼š60ç§’ï¼ˆ60000msï¼‰
2. **è¶…æ—¶ç±»å‹**ï¼šaxiosçš„timeoutå‚æ•°ï¼Œæ§åˆ¶æ•´ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´
3. **è¶…æ—¶å¤„ç†**ï¼šå½“è¯·æ±‚è¶…æ—¶æ—¶ï¼Œaxiosä¼šæŠ›å‡º`ECONNABORTED`é”™è¯¯

### é…ç½®æ–¹å¼
ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼š

**æ–¹å¼1ï¼šç›´æ¥è®¾ç½®**
```javascript
const githubService = require('./src/services/githubService');
githubService.timeout = 30000; // è®¾ç½®ä¸º30ç§’
```

**æ–¹å¼2ï¼šé€šè¿‡é…ç½®æ–‡ä»¶**
åœ¨`.fx-cli/config.json`ä¸­æ·»åŠ ï¼š
```json
{
  "githubTimeout": 30000
}
```

## å½±å“èŒƒå›´
- ä¿®æ”¹æ–‡ä»¶ï¼š`src/services/githubService.js`
- å½±å“æ–¹æ³•ï¼š
  - `getRepoInfo()`
  - `getRepoContent()`
  - `getFileContent()`
  - `getRepoTree()`
- æ–°å¢æ–¹æ³•ï¼š`getRequestConfig()`

## åç»­å»ºè®®
1. **ç›‘æ§è¶…æ—¶æƒ…å†µ**ï¼šå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›‘æ§è¶…æ—¶å‘ç”Ÿçš„é¢‘ç‡ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é»˜è®¤è¶…æ—¶æ—¶é—´
2. **é‡è¯•æœºåˆ¶**ï¼šå¯¹äºè¶…æ—¶é”™è¯¯ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ è‡ªåŠ¨é‡è¯•æœºåˆ¶
3. **é…ç½®æ–‡æ¡£**ï¼šåœ¨ç”¨æˆ·æ–‡æ¡£ä¸­è¯´æ˜å¦‚ä½•è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´

## æ€»ç»“
é€šè¿‡ä¸ºGitHub APIè¯·æ±‚æ·»åŠ è¶…æ—¶è®¾ç½®ï¼ŒæˆåŠŸè§£å†³äº†504 Gateway Timeouté”™è¯¯é—®é¢˜ã€‚æ‰€æœ‰axiosè¯·æ±‚ç°åœ¨éƒ½åº”ç”¨äº†ç»Ÿä¸€çš„è¶…æ—¶é…ç½®ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚
